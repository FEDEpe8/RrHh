<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal RRHH ChascomÃºs</title>
    <meta name="theme-color" content="#004a7c">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/jpeg" href="logo.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary-blue: #004a7c; --accent-green: #97d700; --bg-light: #f4f7f6; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-light); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { background: var(--primary-blue); color: white; padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10; }
        .header-content { display: flex; align-items: center; }
        .header-logo { height: 40px; margin-right: 10px; border-radius: 4px; }
        .header-info h1 { font-size: 0.9rem; margin: 0; }
        .btn-logout { background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; }
        
        .chat-container { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; padding-bottom: 20px; }
        .message-row { display: flex; flex-direction: column; width: 100%; }
        .message { max-width: 85%; padding: 12px 15px; border-radius: 15px; font-size: 0.95rem; line-height: 1.4; }
        .bot { background: white; align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid #ddd; }
        .user { background: var(--primary-blue); color: white; align-self: flex-end; border-bottom-right-radius: 2px; }

        .options-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .option-button { background: white; border: 1.5px solid var(--primary-blue); color: var(--primary-blue); padding: 8px 14px; border-radius: 20px; cursor: pointer; font-weight: 500; font-size: 0.85rem; transition: 0.3s; }
        .option-button:hover { background: var(--primary-blue); color: white; }
        
        .form-card { background: #eef6fc; padding: 15px; border-radius: 12px; border-left: 4px solid var(--primary-blue); width: 90%; margin-top: 5px; box-sizing: border-box; }
        .form-card label { display: block; font-size: 0.7rem; font-weight: bold; color: var(--primary-blue); margin-bottom: 2px; }
        .form-card input, .form-card select { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        .form-actions { display: flex; gap: 5px; }
        .btn-submit { flex: 2; background: #27ae60; color: white; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .btn-cancel { flex: 1; background: #95a5a6; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }

        .input-area { padding: 10px; background: white; display: flex; gap: 8px; border-top: 1px solid #eee; }
        #userInput { flex: 1; padding: 10px 15px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        #sendButton { background: var(--accent-green); border: none; padding: 0 15px; border-radius: 20px; font-weight: bold; cursor: pointer; color: var(--primary-blue); }

        a { color: var(--primary-blue); font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <img src="logo.jpg" alt="Logo" class="header-logo" onerror="this.style.display='none'">
            <div class="header-info"><h1>Portal RRHH ChascomÃºs</h1></div>
        </div>
        <button onclick="clearChat()" class="btn-logout">Salir</button>
    </header>

    <main id="chatMessages" class="chat-container"></main>

    <footer class="input-area">
        <input type="text" id="userInput" placeholder="Escribe tu Nombre y Legajo..." autocomplete="off">
        <button id="sendButton">Enviar</button>
    </footer>

    <script>
        const WHATSAPP_RRHH = "5492241538198";
        const TEL_MEDICINA = "2241000000";

        const menus = {
            main: { id: 'main', title: 'Â¡Hola! Soy tu asistente de RRHH. Â¿QuÃ© trÃ¡mite deseas realizar?', options: [
                { id: 'recibos', label: 'ğŸ“„ Recibos de Sueldo' },
                { id: 'licencias', label: 'ğŸ“ Licencias y ArtÃ­culos' },
                { id: 'medicina', label: 'ğŸ¥ Medicina Laboral' },
                { id: 'faq', label: 'â“ Preguntas Frecuentes' },
                { id: 'contacto', label: 'ğŸ‘¤ Hablar con un Operador', type: 'leaf', apiKey: 'contacto_humano' }
            ]},
            recibos: { id: 'recibos', parent: 'main', title: 'GestiÃ³n de Recibos:', options: [
                { id: 'ir_intranet', label: 'ğŸŒ Entrar a la Intranet', type: 'leaf', apiKey: 'intranet_link' },
                { id: 'error_ingreso', label: 'ğŸ”‘ No puedo ingresar / OlvidÃ© clave', type: 'leaf', apiKey: 'ayuda_clave' }
            ]},
            licencias: { id: 'licencias', parent: 'main', title: 'Selecciona el tipo de licencia:', options: [
                { id: 'form_vacaciones', label: 'ğŸ–ï¸ Vacaciones', type: 'form', formType: 'vacaciones' },
                { id: 'form_articulos', label: 'ğŸ“‘ ArtÃ­culos Especiales', type: 'form', formType: 'articulos' },
                { id: 'lic_info', label: 'â„¹ï¸ InformaciÃ³n de ArtÃ­culos', type: 'leaf', apiKey: 'info_arts' }
            ]},
            medicina: { id: 'medicina', parent: 'main', title: 'Medicina Laboral - Centro CÃ­vico:', options: [
                { id: 'horarios_med', label: 'â° Horarios y DirecciÃ³n', type: 'leaf', apiKey: 'med_info' }
            ]},
            faq: { id: 'faq', parent: 'main', title: 'Dudas frecuentes:', options: [
                { id: 'faq_vacas', label: 'ğŸ“… Â¿CuÃ¡ntos dÃ­as me corresponden?', type: 'leaf', apiKey: 'ans_vacas' },
                { id: 'faq_cert', label: 'â±ï¸ Plazo para certificados', type: 'leaf', apiKey: 'ans_cert' },
                { id: 'faq_art', label: 'ğŸš‘ Â¿QuÃ© hacer ante un accidente?', type: 'leaf', apiKey: 'ans_art' },
                { id: 'faq_rec', label: 'ğŸ“… Â¿CuÃ¡ndo se cobra el haber?', type: 'leaf', apiKey: 'ans_rec' }
            ]}
        };

        const responses = {
            'info_arts': `<strong>ğŸ“‘ ArtÃ­culos Disponibles:</strong><br><br>â€¢ <b>Art 1:</b> Asuntos Particulares.<br>â€¢ <b>Art 2:</b> Familiar Enfermo.<br>â€¢ <b>Art 3:</b> DonaciÃ³n de Sangre.<br>â€¢ <b>Art 4:</b> Fallecimiento Familiar.<br>â€¢ <b>Art 5:</b> Cuidado de hijo.`,
            'intranet_link': `AccedÃ© a tus recibos en la Intranet oficial:<br><br><a href="https://intranet.chascomus.gob.ar/" target="_blank">ğŸ‘‰ Ir a la Intranet</a>`,
            'ayuda_clave': `<strong>ğŸ”‘ Â¿Problemas para ingresar?</strong><br><br>Por favor, comunÃ­cate con un operador e indicÃ¡ tu Nombre completo y Legajo para resetear tu clave.`,
            'med_info': `<strong>ğŸ¥ Medicina Laboral (Centro CÃ­vico)</strong><br><br>ğŸ“ Calle Dorrego esq. Bolivar.<br>ğŸ“ Tel: <a href="tel:${TEL_MEDICINA}">${TEL_MEDICINA}</a><br><br><b>Docentes:</b> Lun, Mar y MiÃ©: 07:30 a 09:00 hs.<br><b>No Docentes:</b> Consultar segÃºn el dÃ­a de la semana.`,
            'ans_vacas': `<strong>ğŸ“… Vacaciones segÃºn AntigÃ¼edad:</strong><br><br>â€¢ < 5 aÃ±os: 14 dÃ­as.<br>â€¢ 5-10 aÃ±os: 21 dÃ­as.<br>â€¢ 10-20 aÃ±os: 28 dÃ­as.<br>â€¢ > 20 aÃ±os: 35 dÃ­as.`,
            'ans_cert': `<strong>â±ï¸ Plazo para certificados:</strong><br><br>Los certificados deben presentarse dentro de las <b>48 horas hÃ¡biles</b> de ocurrida la inasistencia.`,
            'ans_art': `<strong>ğŸš‘ Accidente Laboral:</strong><br><br>1. Avisar a tu jefe directo.<br>2. Llamar a la ART.<br>3. Presentar denuncia en RRHH antes de las 24hs.`,
            'ans_rec': `<strong>ğŸ“… Fecha de Cobro:</strong><br><br>Habitualmente el segundo dÃ­a hÃ¡bil de cada mes. Las horas extras se abonan entre el 15 y 20 de cada mes.`,
            'contacto_humano': `Para hablar con un operador de RRHH (Lun a Vie 8-14hs):<br><br><a href="https://wa.me/${WHATSAPP_RRHH}">ğŸ‘‰ Abrir WhatsApp</a>`
        };

        let userName = localStorage.getItem('hr_user_name') || "";
        let currentPath = ['main'];

        window.onload = () => {
            if (!userName) addBotMessage("Bienvenido. Para comenzar, por favor ingresÃ¡ tu <b>Nombre completo y NÂº de Legajo</b>:");
            else {
                addBotMessage(`Hola de nuevo, <b>${userName}</b>.`);
                renderMenu();
            }
        };

        function processInput() {
            const input = document.getElementById('userInput');
            const val = input.value.trim();
            if (!val) return;
            
            addUserMessage(val);
            if (!userName) {
                if (val.length > 5 && /\d/.test(val)) {
                    userName = val;
                    localStorage.setItem('hr_user_name', userName);
                    addBotMessage(`âœ… Identidad registrada con Ã©xito.`);
                    renderMenu();
                } else {
                    addBotMessage("âŒ Por favor, ingresÃ¡ un nombre y legajo vÃ¡lido (Ej: Juan Perez 1234).");
                }
            } else {
                addBotMessage("Por favor, utilizÃ¡ las opciones del menÃº para navegar.");
            }
            input.value = '';
        }

        function renderMenu() {
            const menuKey = currentPath[currentPath.length - 1];
            const menu = menus[menuKey];
            let opts = [...menu.options];
            
            // Agregar botÃ³n volver si no estamos en el principal
            if (currentPath.length > 1) {
                opts.push({ id: 'back', label: 'â¬…ï¸ Volver al Inicio', type: 'nav' });
            }
            
            addBotMessage(menu.title, true, opts);
        }

        function handleOption(id, label, type, apiKey, formType) {
            if (id === 'back') {
                currentPath = ['main'];
                renderMenu();
                return;
            }
            
            addUserMessage(label);
            
            if (type === 'form') {
                renderForm(formType);
            } else if (type === 'leaf') {
                setTimeout(() => {
                    addBotMessage(responses[apiKey]);
                    // DespuÃ©s de dar una respuesta final, ofrecemos volver al menÃº
                    setTimeout(renderMenu, 1000);
                }, 400);
            } else {
                currentPath.push(id);
                renderMenu();
            }
        }

        function renderForm(type) {
            const formId = `f_${Date.now()}`;
            const isVaca = type === 'vacaciones';
            const html = `
                <div class="form-card" id="${formId}">
                    <strong>${isVaca ? 'ğŸ–ï¸ Solicitud Vacaciones' : 'ğŸ“‘ Otros ArtÃ­culos'}</strong>
                    <label>FECHA INICIO</label><input type="date" id="f_date">
                    <label>${isVaca ? 'CANTIDAD DÃAS' : 'SELECCIONAR ARTÃCULO'}</label>
                    ${isVaca ? 
                        '<input type="number" id="f_val" placeholder="Ej: 14">' : 
                        '<select id="f_val"><option>Art 1 (Asuntos Particulares)</option><option>Art 2 (Familiar Enfermo)</option><option>Art 4 (Fallecimiento)</option><option>Examen/Estudio</option></select>'}
                    <div class="form-actions">
                        <button class="btn-submit" onclick="submitForm('${type}', '${formId}')">ENVIAR</button>
                        <button class="btn-cancel" onclick="cancelForm('${formId}')">CANCELAR</button>
                    </div>
                </div>`;
            addBotMessage("Por favor, completÃ¡ los datos del formulario:");
            const div = document.createElement('div');
            div.innerHTML = html;
            document.getElementById('chatMessages').appendChild(div);
            scrollChat();
        }

        function cancelForm(id) {
            const card = document.getElementById(id);
            card.innerHTML = "<small><i>âŒ Formulario cancelado.</i></small>";
            setTimeout(renderMenu, 1000);
        }

        function submitForm(type, formId) {
            const container = document.getElementById(formId);
            const date = container.querySelector('#f_date').value;
            const val = container.querySelector('#f_val').value;
            
            if(!date || !val) {
                alert("Por favor, completa todos los campos.");
                return;
            }
            
            const text = `*SOLICITUD RRHH*\n\nğŸ‘¤ *Empleado:* ${userName}\nğŸ“‹ *Tipo:* ${type.toUpperCase()}\nğŸ“… *Fecha Inicio:* ${date}\nğŸ“ *Detalle:* ${val}`;
            window.open(`https://wa.me/${WHATSAPP_RRHH}?text=${encodeURIComponent(text)}`, '_blank');
            
            container.innerHTML = "<b>âœ… Solicitud enviada correctamente.</b>";
            setTimeout(renderMenu, 2000);
        }

        function displayMessage(role, text, options) {
            const row = document.createElement('div');
            row.className = `message-row`;
            let html = `<div class="message ${role}">${text}</div>`;
            
            if (options) {
                html += `<div class="options-container">`;
                options.forEach(o => {
                    html += `<button class="option-button" onclick="handleOption('${o.id}','${o.label}','${o.type}','${o.apiKey}','${o.formType}')">${o.label}</button>`;
                });
                html += `</div>`;
            }
            
            row.innerHTML = html;
            document.getElementById('chatMessages').appendChild(row);
            scrollChat();
        }

        function addBotMessage(t, s, o) { displayMessage('bot', t, o); }
        function addUserMessage(t) { displayMessage('user', t); }
        function scrollChat() { 
            const c = document.getElementById('chatMessages'); 
            c.scrollTo({ top: c.scrollHeight, behavior: 'smooth' }); 
        }
        function clearChat() { if(confirm("Â¿Cerrar sesiÃ³n de RRHH?")) { localStorage.clear(); location.reload(); } }

        document.getElementById('sendButton').onclick = processInput;
        document.getElementById('userInput').onkeypress = (e) => { if(e.key === 'Enter') processInput(); };
    </script>
</body>
</html>
