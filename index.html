<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal RRHH ChascomÃºs</title>
    <meta name="theme-color" content="#004a7c">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/jpeg" href="logo.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #004a7c;
            --accent-green: #97d700;
            --bg-light: #f4f7f6;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-light);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background: var(--primary-blue);
            color: white;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .header-content { display: flex; align-items: center; }
        .header-logo { height: 45px; margin-right: 12px; border-radius: 4px; }
        .header-info h1 { font-size: 1rem; margin: 0; }
        .header-info p { font-size: 0.75rem; margin: 0; opacity: 0.8; }

        .btn-logout {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message-row { display: flex; flex-direction: column; width: 100%; }
        .message {
            max-width: 85%;
            padding: 12px 15px;
            border-radius: 15px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .bot { background: white; align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid #ddd; }
        .user { background: var(--primary-blue); color: white; align-self: flex-end; border-bottom-right-radius: 2px; }

        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .option-button {
            background: white;
            border: 1.5px solid var(--primary-blue);
            color: var(--primary-blue);
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
        }

        .form-card {
            background: #eef6fc;
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid var(--primary-blue);
            width: 90%;
        }

        .form-card input, .form-card select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        .btn-submit { background: #27ae60; color: white; border: none; padding: 10px; border-radius: 6px; font-weight: bold; width: 100%; cursor: pointer; }

        .btn-intranet {
            display: inline-block;
            background: var(--primary-blue);
            color: white !important;
            text-decoration: none;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 10px;
        }

        .input-area { padding: 12px; background: white; display: flex; gap: 10px; border-top: 1px solid #eee; }
        #userInput { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none; }
        #sendButton { background: var(--accent-green); border: none; padding: 0 18px; border-radius: 25px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <img src="logo.jpg" alt="Logo" class="header-logo">
            <div class="header-info">
                <h1>Portal de RRHH</h1>
                <p>Muni ChascomÃºs</p>
            </div>
        </div>
        <button onclick="clearChat()" class="btn-logout">Cerrar SesiÃ³n</button>
    </header>

    <main id="chatMessages" class="chat-container"></main>

    <footer class="input-area">
        <input type="text" id="userInput" placeholder="Escribe aquÃ­..." autocomplete="off">
        <button id="sendButton">Enviar</button>
    </footer>

    <script>
        const WHATSAPP_RRHH = "5492241538198"; //
        const TEL_MEDICINA = "2241000000"; //

        const menus = {
            main: { id: 'main', title: 'Portal de RRHH. Â¿QuÃ© trÃ¡mite deseas realizar?', options: [
                { id: 'recibos', label: 'ğŸ“„ Recibos de Sueldo' },
                { id: 'licencias', label: 'ğŸ“ Licencias y ArtÃ­culos' },
                { id: 'medicina', label: 'ğŸ¥ Medicina Laboral' },
                { id: 'faq', label: 'â“ Preguntas Frecuentes' },
                { id: 'contacto', label: 'ğŸ‘¤ Hablar con un Operador', type: 'leaf', apiKey: 'contacto_humano' }
            ]},
            recibos: { id: 'recibos', parent: 'main', title: 'GestiÃ³n de Recibos:', options: [
                { id: 'ir_intranet', label: 'ğŸŒ Entrar a la Intranet', type: 'leaf', apiKey: 'intranet_link' },
                { id: 'error_ingreso', label: 'ğŸ”‘ No puedo ingresar / Clave', type: 'leaf', apiKey: 'ayuda_clave' }
            ]},
            licencias: { id: 'licencias', parent: 'main', title: 'Selecciona el tipo de licencia:', options: [
                { id: 'form_vacaciones', label: 'ğŸ–ï¸ Vacaciones', type: 'form', formType: 'vacaciones' },
                { id: 'form_articulos', label: 'ğŸ“‘ ArtÃ­culos y Licencias Especiales', type: 'form', formType: 'articulos' }
            ]},
            medicina: { id: 'medicina', parent: 'main', title: 'Medicina Laboral - Centro CÃ­vico:', options: [
                { id: 'horarios_med', label: 'â° Horarios y DirecciÃ³n', type: 'leaf', apiKey: 'med_info' }
            ]},
            faq: { id: 'faq', parent: 'main', title: 'Dudas frecuentes:', options: [
                { id: 'faq_vacas', label: 'ğŸ“… Â¿CuÃ¡ntos dÃ­as me corresponden?', type: 'leaf', apiKey: 'ans_vacas' },
                { id: 'faq_cert', label: 'â±ï¸ Plazo para certificados', type: 'leaf', apiKey: 'ans_cert' },
                { id: 'faq_art', label: 'ğŸš‘ Â¿QuÃ© hacer ante un accidente?', type: 'leaf', apiKey: 'ans_art' },
                { id: 'faq_rec', label: 'ğŸ“… Â¿CuÃ¡ndo se cobra el haber?', type: 'leaf', apiKey: 'ans_rec' }
            ]}
        }; //

        const responses = {
            'intranet_link': `AccedÃ© a tus recibos en la Intranet oficial:<br><br><a href="https://intranet.chascomus.gob.ar/" target="_blank" class="btn-intranet">ğŸ‘‰ Ir a la Intranet</a>`,
            'ayuda_clave': `<strong>ğŸ”‘ Â¿Problemas para ingresar?</strong><br><br>Habla con la operadora e IncluÃ­ Nombre, Apellido y Legajo para resetear tu cuenta.`,
            'med_info': `<strong>ğŸ¥ Medicina Laboral (Centro CÃ­vico)</strong><br><br>
        ğŸ“ <b>UbicaciÃ³n:</b> Calle Dorrego esq. Bolivar.<br>
        ğŸ“ <b>TelÃ©fono:</b> <a href="tel:${TEL_MEDICINA}">${TEL_MEDICINA}</a><br><br>
        ğŸ <b>Personal Docente:</b><br>
        â€¢ Lun, Mar y MiÃ©: 07:30 a 09:00 hs.<br><br>
        ğŸ’¼ <b>Personal No Docente:</b><br>
        â€¢ Lunes: 14:00 a 16:30 hs.<br>
        â€¢ Martes: 09:00 a 11:00 hs.<br>
        â€¢ MiÃ©rcoles: 10:00 a 12:30 hs.<br>
        â€¢ Jueves: 09:00 a 11:00 hs.<br>
        â€¢ Viernes: 10:00 a 12:30 hs.`,
            'ans_vacas': `<strong>ğŸ“… Vacaciones segÃºn AntigÃ¼edad:</strong><br><br>â€¢ < 5 aÃ±os: 14 dÃ­as.<br>â€¢ 5-10 aÃ±os: 21 dÃ­as.<br>â€¢ 10-20 aÃ±os: 28 dÃ­as.<br>â€¢ > 20 aÃ±os: 35 dÃ­as.`,
            'ans_cert': `<strong>â±ï¸ Plazo para certificados:</strong><br><br>Presentar dentro de las <b>48 horas hÃ¡biles</b> de la inasistencia.`,
            'ans_art': `<strong>ğŸš‘ Accidente Laboral:</strong><br><br>1. Avisar al jefe.<br>2. Llamar a la ART.<br>3. Denunciar en RRHH antes de las 24hs.`,
            'ans_rec': `<strong>ğŸ“… Haberes:</strong><br><br>1. El segundo dÃ­a hÃ¡bil del mes.<br>2. Extras entre el 15 y 20 de cada mes.`,
            'contacto_humano': `Contacto RRHH (Lun a Vie 8-14hs):<br><br><a href="https://wa.me/${WHATSAPP_RRHH}" class="btn-intranet" style="background:#25d366">Chatear con RRHH</a>`
        }; //

        let userName = localStorage.getItem('hr_user_name') || "";
        let currentPath = ['main'];

        window.onload = () => {
            if (!userName) {
                addBotMessage("Bienvenido al Portal de RRHH.<br><br>âš ï¸ <b>ACCESO RESTRINGIDO</b>: Para continuar, por favor ingresÃ¡ tu <b>Nombre completo y Legajo</b>:");
            } else {
                addBotMessage(`Hola de nuevo, <b>${userName}</b>.`);
                renderMenu();
            }
        };

        function processInput() {
            const input = document.getElementById('userInput');
            const val = input.value.trim();
            if (!val) return;
            
            addUserMessage(val);
            if (!userName) {
                if (val.length > 5 && /\d/.test(val)) {
                    userName = val;
                    localStorage.setItem('hr_user_name', userName);
                    addBotMessage(`âœ… Identidad verificada. Bienvenid@ <b>${userName}</b>.`);
                    renderMenu();
                } else {
                    addBotMessage("âŒ <b>Datos insuficientes.</b> IngresÃ¡ Nombre, Apellido y Legajo.");
                }
            } else {
                addBotMessage("Por favor, utilizÃ¡ los botones del menÃº para navegar.");
            }
            input.value = '';
        }

        function renderMenu() {
            const menu = menus[currentPath[currentPath.length - 1]];
            let opts = [...menu.options];
            if (currentPath.length > 1) opts.push({ id: 'back', label: 'â¬…ï¸ Volver', type: 'nav' });
            addBotMessage(menu.title, true, opts);
        }

        function handleOption(id, label, type, apiKey, formType) {
            addUserMessage(label);
            if (id === 'back') { currentPath.pop(); renderMenu(); return; }
            if (type === 'form') { renderForm(formType); } 
            else if (type === 'leaf') { setTimeout(() => { addBotMessage(responses[apiKey]); renderMenu(); }, 400); } 
            else { currentPath.push(id); renderMenu(); }
        }

        function renderForm(type) {
            const formId = `f_${Date.now()}`;
            const isVaca = type === 'vacaciones';
            const html = `
                <div class="form-card" id="${formId}">
                    <strong>${isVaca ? 'ğŸ–ï¸ Solicitud de Vacaciones' : 'ğŸ“‘ Licencia/ArtÃ­culos'}</strong>
                    <label>FECHA INICIO</label><input type="date" id="f_date">
                    <label>${isVaca ? 'DÃAS' : 'MOTIVO'}</label>
                    ${isVaca ? '<input type="number" id="f_val" placeholder="Ej: 14">' : '<select id="f_val"><option>Asuntos Particulares</option><option>Familiar Enfermo</option><option>Estudio</option></select>'}
                    <button class="btn-submit" onclick="submitForm('${type}', '${formId}')">ENVIAR A RRHH</button>
                </div>`;
            addBotMessage("CompletÃ¡ los datos para enviar:");
            const div = document.createElement('div');
            div.innerHTML = html;
            document.getElementById('chatMessages').appendChild(div);
            scrollChat();
        }

        function submitForm(type, formId) {
            const container = document.getElementById(formId);
            const date = container.querySelector('#f_date').value;
            const val = container.querySelector('#f_val').value;
            if(!date || !val) { alert("CompletÃ¡ los campos"); return; }
            
            const msg = `*SOLICITUD RRHH - ${type.toUpperCase()}*\nğŸ‘¤ Empleado: ${userName}\nğŸ“… Inicio: ${date}\nğŸ“ Detalle: ${val}`;
            window.open(`https://wa.me/${WHATSAPP_RRHH}?text=${encodeURIComponent(msg)}`, '_blank');
            container.innerHTML = "<b style='color:#27ae60'>âœ… Solicitud enviada correctamente.</b>";
            setTimeout(renderMenu, 2500);
        }

        function displayMessage(role, text, options) {
            const row = document.createElement('div');
            row.className = `message-row`;
            let html = `<div class="message ${role}">${text}</div>`;
            if (options) {
                html += `<div class="options-container">`;
                options.forEach(o => {
                    html += `<button class="option-button" onclick="handleOption('${o.id}','${o.label}','${o.type}','${o.apiKey}','${o.formType}')">${o.label}</button>`;
                });
                html += `</div>`;
            }
            row.innerHTML = html;
            document.getElementById('chatMessages').appendChild(row);
            scrollChat();
        }

        function addBotMessage(t, s, o) { displayMessage('bot', t, o); }
        function addUserMessage(t) { displayMessage('user', t); }
        function scrollChat() { const c = document.getElementById('chatMessages'); c.scrollTop = c.scrollHeight; }
        function clearChat() { if(confirm("Â¿Cerrar sesiÃ³n de RRHH?")) { localStorage.clear(); location.reload(); } }

        document.getElementById('sendButton').onclick = processInput;
        document.getElementById('userInput').onkeypress = (e) => { if(e.key === 'Enter') processInput(); };

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').catch(console.error);
        } //
    </script>
</body>
</html>